document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("comic-list"),e=document.getElementById("loading-message"),n=document.getElementById("section-title"),a=document.getElementById("genre-dropdown-menu"),s=document.getElementById("search-form"),o=document.getElementById("search-input");s.addEventListener("submit",t=>{t.preventDefault();const e=o.value.trim();e&&(window.location.href=`search.html?keyword=${encodeURIComponent(e)}`)}),async function(){t.innerHTML="",e.style.display="block",n.textContent="Danh Sách Truyện Mới Cập Nhật";try{const n=(await axios.get("https://otruyenapi.com/v1/api/home")).data.data,a=n.items||n.comic_data||[];e.style.display="none",a.length>0?a.forEach(e=>{const n=e.slug||"default-slug",a="https://img.otruyenapi.com/uploads/comics/"+(e.thumb_url||"no-image.jpg"),s=e.category&&Array.isArray(e.category)?e.category.map(t=>t.name).join(", "):"Đang cập nhật",o=e.author&&Array.isArray(e.author)&&e.author.length>0&&""!==e.author[0]?e.author.join(", "):"Đang cập nhật",r="ongoing"===e.status?"Đang tiến hành":"completed"===e.status?"Hoàn thành":"Chưa xác định";let c="Chưa cập nhật";e.chaptersLatest&&e.chaptersLatest.length>0?c=`Chapter ${e.chaptersLatest[0].chapter_name}`:e.chaptersLatest&&"object"==typeof e.chaptersLatest&&e.chaptersLatest.chapter_name&&(c=`Chapter ${e.chaptersLatest.chapter_name}`);const i=`\n                        <div class="col-6 col-md-3 col-lg-2 mb-4">\n                            <div class="card h-100 comic-card">\n                                <a href="comic-detail.html?slug=${n}">\n                                    <img src="${a}" class="card-img-top" alt="${e.name}">\n                                    <div class="card-body">\n                                        <h5 class="card-title">${e.name}</h5>\n                                        <p class="card-text small text-muted"><strong>Thể loại:</strong> ${s}</p>\n                                        <p class="card-text small text-muted"><strong>Tác giả:</strong> ${o}</p>\n                                        <p class="card-text small text-muted"><strong>Trạng thái:</strong> ${r}</p>\n                                        <p class="card-text small text-primary mt-auto"><strong>Mới nhất:</strong> ${c}</p>\n                                    </div>\n                                </a>\n                            </div>\n                        </div>\n                    `;t.innerHTML+=i}):t.innerHTML='<p class="text-center text-muted">Không tìm thấy truyện nào.</p>'}catch(n){console.error("Lỗi khi tải truyện:",n),t.innerHTML='<p class="text-center text-danger">Có lỗi xảy ra khi tải truyện. Vui lòng thử lại sau.</p>',e.style.display="none"}}(),async function(){try{const t=(await axios.get("https://otruyenapi.com/v1/api/the-loai")).data.data.items;a.innerHTML="",t.forEach(t=>{const e=document.createElement("li");e.innerHTML=`<a class="dropdown-item" href="genre.html?genre=${t.slug}">${t.name}</a>`,a.appendChild(e)})}catch(t){console.error("Lỗi khi tải thể loại:",t),a.innerHTML='<li><a class="dropdown-item" href="#">Lỗi tải thể loại</a></li>'}}()});
